
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>2. Statistics with statsmodels and scipy.stats &#8212; An introduction to data analysis in Python</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. Generalised Linear Models" href="generalised.html" />
    <link rel="prev" title="1. (Frequentist) Statistics in Python" href="pingouin.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">An introduction to data analysis in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    An introduction to data analysis in Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The Basics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter1/the_basics.html">
   1. The Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter1/data_collections.html">
   2. Data collections
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter1/functions.html">
   3. Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter1/loops.html">
   4. Loops
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NumPy
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter2/imports.html">
   1. Starting data handling in Python - NumPy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter2/basic_numpy.html">
   2. The
   <code class="docutils literal notranslate">
    <span class="pre">
     numpy
    </span>
   </code>
   module
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter2/stats_simulation.html">
   3. Data indexing, simulation, and summary statistics
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  pandas
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter3/pandas_import_describe.html">
   1. The
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas
    </span>
   </code>
   module
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter3/indexing.html">
   2. Accessing data in Pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter3/booleans.html">
   3. Boolean operations with Pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter3/split_apply_combine.html">
   4. The power of
   <code class="docutils literal notranslate">
    <span class="pre">
     groupby
    </span>
   </code>
   and aggregation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter3/custom_functions_flow.html">
   5. Custom functions
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  pandas - advanced uses
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter4/apply.html">
   1. Advanced data handling with
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter4/go_long.html">
   2. Data surgery - reshaping data with
   <code class="docutils literal notranslate">
    <span class="pre">
     melt
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter4/go_wide.html">
   3. There and back again - reshaping data with
   <code class="docutils literal notranslate">
    <span class="pre">
     .pivot_table()
    </span>
   </code>
   .
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter4/merge_join.html">
   4. Data surgery - joining DataFrames with
   <code class="docutils literal notranslate">
    <span class="pre">
     pd.concat
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     pd.merge
    </span>
   </code>
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data Visualisation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter5/matplotlib.html">
   1. Introducing
   <code class="docutils literal notranslate">
    <span class="pre">
     matplotlib
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter5/seaborn.html">
   2. Using
   <code class="docutils literal notranslate">
    <span class="pre">
     seaborn
    </span>
   </code>
   for smoother data visualisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter5/advanced_seaborn.html">
   3. Advanced plotting with
   <code class="docutils literal notranslate">
    <span class="pre">
     seaborn
    </span>
   </code>
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Statistical Analysis
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="pingouin.html">
   1. (Frequentist) Statistics in Python
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   2. Statistics with
   <code class="docutils literal notranslate">
    <span class="pre">
     statsmodels
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     scipy.stats
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="generalised.html">
   3. Generalised Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lmm.html">
   4. Hierarchical or mixed models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ijalm.html">
   5.
   <strong>
    Bonus section
   </strong>
   -
   <strong>
    I
   </strong>
   ts
   <strong>
    J
   </strong>
   ust
   <strong>
    A
   </strong>
   <strong>
    L
   </strong>
   inear
   <strong>
    M
   </strong>
   odel
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/chapter6/statsmodels.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/executablebooks/jupyter-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fchapter6/statsmodels.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/chapter6/statsmodels.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#statsmodels-introduction-to-ordinary-least-squares-and-the-formula-interface">
   2.1. statsmodels - introduction to ordinary least squares and the formula interface
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-resultswrapper-object">
     2.1.1. The
     <code class="docutils literal notranslate">
      <span class="pre">
       ResultsWrapper
      </span>
     </code>
     object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prediction-objects">
     2.1.2. Prediction Objects
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#marginal-predictions-or-counterfactuals">
     2.1.3. Marginal predictions or counterfactuals
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Statistics with statsmodels and scipy.stats</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#statsmodels-introduction-to-ordinary-least-squares-and-the-formula-interface">
   2.1. statsmodels - introduction to ordinary least squares and the formula interface
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-resultswrapper-object">
     2.1.1. The
     <code class="docutils literal notranslate">
      <span class="pre">
       ResultsWrapper
      </span>
     </code>
     object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prediction-objects">
     2.1.2. Prediction Objects
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#marginal-predictions-or-counterfactuals">
     2.1.3. Marginal predictions or counterfactuals
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="statistics-with-statsmodels-and-scipy-stats">
<h1><span class="section-number">2. </span>Statistics with <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> and <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code><a class="headerlink" href="#statistics-with-statsmodels-and-scipy-stats" title="Permalink to this headline">#</a></h1>
<p>Python has two mature and powerful packages for statistical inference that are general in nature - <code class="docutils literal notranslate"><span class="pre">scipy</span></code> and <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>. In fact, <code class="docutils literal notranslate"><span class="pre">pingouin</span></code> relies pretty much entirely on these packages for behind-the-scenes computation. Nothing beats diving into the details, so this section will take a close look at these packages.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> allows users to fit a wide range of general and generalized linear models, random effects models, general additive models, and more. Often, one can fit these models using a “formula” style syntax that is inspired by <code class="docutils literal notranslate"><span class="pre">R</span></code>. As your statistical knowledge and comfort grows, you will want to progress to using this module as it is fully flexible - for example, it can estimate ordinal or Poisson regression models, which <code class="docutils literal notranslate"><span class="pre">pingouin</span></code> cannot. I find I use <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> daily.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scipy</span></code>, and in particular its <code class="docutils literal notranslate"><span class="pre">.stats</span></code> submodule, contain a range of useful statistical functions like <code class="docutils literal notranslate"><span class="pre">zscore</span></code>, <code class="docutils literal notranslate"><span class="pre">pearsonr</span></code>, and many more, as well as carrying a range of statistical distributions that allow you to estimate the probability of data in a clean and straightforward way.</p></li>
</ul>
<p>We will examine <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> in some detail here, in particular the workhorse of statistical inference - <strong>ordinary least squares</strong>, which is heavily used in psychology and beyond to estimate linear models.</p>
<section id="statsmodels-introduction-to-ordinary-least-squares-and-the-formula-interface">
<h2><span class="section-number">2.1. </span>statsmodels - introduction to ordinary least squares and the formula interface<a class="headerlink" href="#statsmodels-introduction-to-ordinary-least-squares-and-the-formula-interface" title="Permalink to this headline">#</a></h2>
<p>Ordinary least squares fits a line to data - a so-called <em>linear model</em>. The slope and intercepts of those lines can be use to make inferences about the relationship between variables.</p>
<p><code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> allows you to specify those relationships with a <strong>formula string</strong>. The formula interface to <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> is imported as <code class="docutils literal notranslate"><span class="pre">smf</span></code>. An example will make things clearer, using the <code class="docutils literal notranslate"><span class="pre">crash</span></code> dataset from the previous example. Lets load up the usual packages in addition to <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pingouin</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span> <span class="c1"># the formula interface of statsmodels</span>

<span class="n">crash</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;car_crashes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/alexjones/opt/anaconda3/envs/py10/lib/python3.10/site-packages/outdated/utils.py:14: OutdatedPackageWarning: The package pingouin is out of date. Your version is 0.5.1, the latest is 0.5.2.
Set the environment variable OUTDATED_IGNORE=1 to disable these warnings.
  return warn(
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lets say we want to predict ins_losses from speeding, alcohol, and ins_premium</span>
<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;ins_losses ~ 1 + speeding + alcohol + ins_premium&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>This formula specifies that we predicting <code class="docutils literal notranslate"><span class="pre">ins_losses</span></code> from the additive model of <code class="docutils literal notranslate"><span class="pre">speeding</span></code>, <code class="docutils literal notranslate"><span class="pre">alcohol</span></code>, and <code class="docutils literal notranslate"><span class="pre">ins_premium</span></code> variables. Starting the formula a ‘1 +’ simply means to compute a intercept. To build this model, we first need to pass it to the <code class="docutils literal notranslate"><span class="pre">ols</span></code> class from <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> and give it the associated data, and store it in a variable. Then, we need to call the <code class="docutils literal notranslate"><span class="pre">.fit()</span></code> method on this model - this will actually carry out the maths behind regression. Its easy to do this in one step. Once done, we can access the <code class="docutils literal notranslate"><span class="pre">.summary()</span></code> method and look at the model. <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> produces an in-depth output that contains all the data we need for analysis - particularly the coefficients, <span class="math notranslate nohighlight">\(R^2\)</span>, <span class="math notranslate nohighlight">\(F\)</span> values, and degrees of freedom.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build a model and fit it at the same time.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">crash</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Examine the results</span>
<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>       <td>ins_losses</td>    <th>  R-squared:         </th> <td>   0.389</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.350</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   9.959</td>
</tr>
<tr>
  <th>Date:</th>             <td>Tue, 05 Jul 2022</td> <th>  Prob (F-statistic):</th> <td>3.40e-05</td>
</tr>
<tr>
  <th>Time:</th>                 <td>12:25:00</td>     <th>  Log-Likelihood:    </th> <td> -223.14</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>    51</td>      <th>  AIC:               </th> <td>   454.3</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>    47</td>      <th>  BIC:               </th> <td>   462.0</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     3</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
       <td></td>          <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>   <td>   58.3212</td> <td>   17.892</td> <td>    3.260</td> <td> 0.002</td> <td>   22.327</td> <td>   94.315</td>
</tr>
<tr>
  <th>speeding</th>    <td>   -0.2978</td> <td>    1.893</td> <td>   -0.157</td> <td> 0.876</td> <td>   -4.106</td> <td>    3.510</td>
</tr>
<tr>
  <th>alcohol</th>     <td>    0.1428</td> <td>    2.235</td> <td>    0.064</td> <td> 0.949</td> <td>   -4.353</td> <td>    4.639</td>
</tr>
<tr>
  <th>ins_premium</th> <td>    0.0868</td> <td>    0.016</td> <td>    5.375</td> <td> 0.000</td> <td>    0.054</td> <td>    0.119</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td> 0.929</td> <th>  Durbin-Watson:     </th> <td>   2.253</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.629</td> <th>  Jarque-Bera (JB):  </th> <td>   0.953</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 0.297</td> <th>  Prob(JB):          </th> <td>   0.621</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 2.689</td> <th>  Cond. No.          </th> <td>5.78e+03</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The condition number is large, 5.78e+03. This might indicate that there are<br/>strong multicollinearity or other numerical problems.</div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> produces an in-depth output that contains all the data we need for analysis - particularly the coefficients, <span class="math notranslate nohighlight">\(R^2\)</span>, <span class="math notranslate nohighlight">\(F\)</span> values, and degrees of freedom, as well as other kinds of model fit such as <span class="math notranslate nohighlight">\(AIC\)</span> - Akaike’s Information Criterion, as well as <span class="math notranslate nohighlight">\(BIC\)</span>, the Bayesian Information Criterion.</p>
<section id="the-resultswrapper-object">
<h3><span class="section-number">2.1.1. </span>The <code class="docutils literal notranslate"><span class="pre">ResultsWrapper</span></code> object<a class="headerlink" href="#the-resultswrapper-object" title="Permalink to this headline">#</a></h3>
<p>A fitted regression model, like the <code class="docutils literal notranslate"><span class="pre">model</span></code> variable above, is a special type of object from <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> called a <code class="docutils literal notranslate"><span class="pre">ResultsWrapper</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>statsmodels.regression.linear_model.RegressionResultsWrapper
</pre></div>
</div>
</div>
</div>
<p>This object has a range of extremely useful attributes. For example, it contains the <code class="docutils literal notranslate"><span class="pre">.fittedvalues</span></code> and <code class="docutils literal notranslate"><span class="pre">.resid</span></code> attributes, which are the predicted values, and residuals (observed - predicted), respectively. Both are stored as <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">Series</span></code> objects (one-dimensional DataFrames).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get predicted</span>
<span class="n">display</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">fittedvalues</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># Get errors</span>
<span class="n">display</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    125.019442
1    148.169326
2    135.174427
3    129.741571
4    133.771227
dtype: float64
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    20.060558
1   -14.239326
2   -24.824427
3    12.648429
4    31.858773
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>This makes it very easy to check model assumptions graphically:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check residual plot of errors against predictions</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>
<span class="n">plot</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.lines.Line2D at 0x1384f3bb0&gt;
</pre></div>
</div>
<img alt="../_images/statsmodels_12_1.png" src="../_images/statsmodels_12_1.png" />
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ResultsWrapper</span></code> contains a range of other useful attributes and methods, including robust covariances and tests for linear parameter contrasts. For example, we can test whether the <code class="docutils literal notranslate"><span class="pre">alcohol</span></code> coefficient is different from .10, and whether the <code class="docutils literal notranslate"><span class="pre">ins_premium</span></code> and <code class="docutils literal notranslate"><span class="pre">alcohol</span></code> coefficients are significantly different, using the <code class="docutils literal notranslate"><span class="pre">.t_test</span></code> method, as well as a formula string describing our tests:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">t_test</span><span class="p">(</span><span class="s1">&#39;ins_premium = alcohol, alcohol = .10&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;statsmodels.stats.contrast.ContrastResults&#39;&gt;
                             Test for Constraints                             
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
c0            -0.0560      2.232     -0.025      0.980      -4.547       4.435
c1             0.1428      2.235      0.019      0.985      -4.353       4.639
==============================================================================
</pre></div>
</div>
</div>
</div>
</section>
<section id="prediction-objects">
<h3><span class="section-number">2.1.2. </span>Prediction Objects<a class="headerlink" href="#prediction-objects" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">ResultsWrapper</span></code> object also has a very helpful method named <code class="docutils literal notranslate"><span class="pre">.get_prediction</span></code>. This allows for inference on either the fitted data (call the method without any arguments) or on new, held out data (pass the DataFrame with the data to the method).</p>
<p>The method returns a <code class="docutils literal notranslate"><span class="pre">PredictionResults</span></code> object, which contains the predicted values as well as their uncertainty in terms of the confidence intervals around both the average prediction and the prediction interval (where new observed values may fall).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">PredictionResults</span></code> object has a <em>further</em> method, <code class="docutils literal notranslate"><span class="pre">.summary_frame</span></code>, which will return the data in a DataFrame. Let’s get the predictions of the insurance losses we modelled above, for the in-sample data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the in-sample predictions</span>
<span class="n">in_sample_predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_prediction</span><span class="p">()</span><span class="o">.</span><span class="n">summary_frame</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">in_sample_predictions</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>mean_se</th>
      <th>mean_ci_lower</th>
      <th>mean_ci_upper</th>
      <th>obs_ci_lower</th>
      <th>obs_ci_upper</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>125.019442</td>
      <td>4.779806</td>
      <td>115.403713</td>
      <td>134.635170</td>
      <td>83.594182</td>
      <td>166.444702</td>
    </tr>
    <tr>
      <th>1</th>
      <td>148.169326</td>
      <td>6.308884</td>
      <td>135.477489</td>
      <td>160.861163</td>
      <td>105.923940</td>
      <td>190.414712</td>
    </tr>
    <tr>
      <th>2</th>
      <td>135.174427</td>
      <td>3.722046</td>
      <td>127.686636</td>
      <td>142.662218</td>
      <td>94.190809</td>
      <td>176.158045</td>
    </tr>
    <tr>
      <th>3</th>
      <td>129.741571</td>
      <td>4.563009</td>
      <td>120.561981</td>
      <td>138.921161</td>
      <td>88.415371</td>
      <td>171.067771</td>
    </tr>
    <tr>
      <th>4</th>
      <td>133.771227</td>
      <td>3.879437</td>
      <td>125.966807</td>
      <td>141.575648</td>
      <td>92.728580</td>
      <td>174.813875</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>There is a row for each observation. The <code class="docutils literal notranslate"><span class="pre">mean</span></code> column represents the prediction, and is identical to the <code class="docutils literal notranslate"><span class="pre">.fittedvalues</span></code> data. The <code class="docutils literal notranslate"><span class="pre">mean_se</span></code> is an estimate of the standard error of each prediction, and the <code class="docutils literal notranslate"><span class="pre">ci</span></code> columns represent the confidence interval around the mean. The <code class="docutils literal notranslate"><span class="pre">obs_ci</span></code> represents something different, the interval for within which new data points would be expected to fall (<em>not</em> the average).</p>
</section>
<section id="marginal-predictions-or-counterfactuals">
<h3><span class="section-number">2.1.3. </span>Marginal predictions or counterfactuals<a class="headerlink" href="#marginal-predictions-or-counterfactuals" title="Permalink to this headline">#</a></h3>
<p>Lets take this a step further and explore the elegance of modelling for examining statistical relationships. We can explore the <strong>marginal predictions</strong> of variables by “holding constant” others, and use the tools we’ve seen above to get some uncertainty around this. Imagine that we are interested in the relationship between insurance premiums and insurance losses in accidents, while we account for speeding and alcohol. <code class="docutils literal notranslate"><span class="pre">ins_premium</span></code> was our only significant predictor in our model above (check <code class="docutils literal notranslate"><span class="pre">model.summary()</span></code> for a refresher), and we can examine what this looks like.</p>
<p>To do this, we need to take our fitted model and have it predict a ‘counterfactual’ world, where insurance premium varies but alcohol and speeding are held at some particular value. This ‘particular value’ can be anything we want, but it is typically the mean of a predictor variable. Below, we will ask the model to predict the insurance loss for the observed insurance premium data, but we will fix alcohol and speeding to be at their mean. Doing so with <code class="docutils literal notranslate"><span class="pre">pandas</span></code> is easy:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a &#39;new&#39; dataset to predict:</span>
<span class="n">new_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">crash</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ins_losses&#39;</span><span class="p">,</span> <span class="s1">&#39;ins_premium&#39;</span><span class="p">])</span> <span class="c1"># gets the existing data columns</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">alcohol</span> <span class="o">=</span> <span class="n">crash</span><span class="p">[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="n">speeding</span> <span class="o">=</span> <span class="n">crash</span><span class="p">[</span><span class="s1">&#39;speeding&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
           <span class="p">)</span>

<span class="n">new_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ins_losses</th>
      <th>ins_premium</th>
      <th>alcohol</th>
      <th>speeding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>145.08</td>
      <td>784.55</td>
      <td>4.886784</td>
      <td>4.998196</td>
    </tr>
    <tr>
      <th>1</th>
      <td>133.93</td>
      <td>1053.48</td>
      <td>4.886784</td>
      <td>4.998196</td>
    </tr>
    <tr>
      <th>2</th>
      <td>110.35</td>
      <td>899.47</td>
      <td>4.886784</td>
      <td>4.998196</td>
    </tr>
    <tr>
      <th>3</th>
      <td>142.39</td>
      <td>827.34</td>
      <td>4.886784</td>
      <td>4.998196</td>
    </tr>
    <tr>
      <th>4</th>
      <td>165.63</td>
      <td>878.41</td>
      <td>4.886784</td>
      <td>4.998196</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>So we have a new dataset with the same insurance loss and insurance premium as before, but now we’re imagining a world in which all the accidents took place where alcohol use was average, and speeding was also average. Note that these column names here <strong>must</strong> reflect the original column names used in the model fitting stage, or it will not work.</p>
<p>We next pass this data to the <code class="docutils literal notranslate"><span class="pre">get_prediction</span></code> method, and we immediately call the <code class="docutils literal notranslate"><span class="pre">summary_frame</span></code> method to get the predictions formatted nicely:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get new predictions</span>
<span class="n">new_predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_prediction</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span><span class="o">.</span><span class="n">summary_frame</span><span class="p">()</span>
<span class="n">new_predictions</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>mean_se</th>
      <th>mean_ci_lower</th>
      <th>mean_ci_upper</th>
      <th>obs_ci_lower</th>
      <th>obs_ci_upper</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>125.607033</td>
      <td>3.255652</td>
      <td>119.057505</td>
      <td>132.156561</td>
      <td>84.784414</td>
      <td>166.429652</td>
    </tr>
    <tr>
      <th>1</th>
      <td>148.942596</td>
      <td>3.884950</td>
      <td>141.127084</td>
      <td>156.758108</td>
      <td>107.897838</td>
      <td>189.987353</td>
    </tr>
    <tr>
      <th>2</th>
      <td>135.578858</td>
      <td>2.811930</td>
      <td>129.921984</td>
      <td>141.235732</td>
      <td>94.889914</td>
      <td>176.267801</td>
    </tr>
    <tr>
      <th>3</th>
      <td>129.320002</td>
      <td>2.965204</td>
      <td>123.354781</td>
      <td>135.285222</td>
      <td>88.587045</td>
      <td>170.052959</td>
    </tr>
    <tr>
      <th>4</th>
      <td>133.751442</td>
      <td>2.808058</td>
      <td>128.102357</td>
      <td>139.400526</td>
      <td>93.063580</td>
      <td>174.439303</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>It would be great to plot this data, but one tricky extra step is that plotting is made easier by sorting the predictions by the predictor of interest. One way to do this is to join everything into one dataset (the new data and the predictions) and plot <em>that</em>, like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Join data together</span>
<span class="n">new_predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">new_data</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">new_predictions</span><span class="p">,</span>
                           <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;ins_premium&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use context manager</span>
<span class="k">with</span> <span class="n">sns</span><span class="o">.</span><span class="n">plotting_context</span><span class="p">(</span><span class="s1">&#39;talk&#39;</span><span class="p">):</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    
    <span class="c1"># Seaborn lineplot to show the relationship</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">new_predictions</span><span class="p">[</span><span class="s1">&#39;ins_premium&#39;</span><span class="p">],</span> 
                 <span class="n">y</span><span class="o">=</span><span class="n">new_predictions</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> 
                 <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span>
                 <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                 <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    
    <span class="c1"># Fill between is an axis method that shades an area between two Y and one X dataset</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">new_predictions</span><span class="p">[</span><span class="s1">&#39;ins_premium&#39;</span><span class="p">],</span> 
                    <span class="n">new_predictions</span><span class="p">[</span><span class="s1">&#39;mean_ci_lower&#39;</span><span class="p">],</span> 
                    <span class="n">new_predictions</span><span class="p">[</span><span class="s1">&#39;mean_ci_upper&#39;</span><span class="p">],</span> 
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> 
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> 
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean CI&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">new_predictions</span><span class="p">[</span><span class="s1">&#39;ins_premium&#39;</span><span class="p">],</span> 
                    <span class="n">new_predictions</span><span class="p">[</span><span class="s1">&#39;obs_ci_lower&#39;</span><span class="p">],</span> 
                    <span class="n">new_predictions</span><span class="p">[</span><span class="s1">&#39;obs_ci_upper&#39;</span><span class="p">],</span> 
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> 
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> 
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction CI&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span> <span class="c1"># show legend</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Predicted Insurance Loss $&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Insurance Premium $&#39;</span><span class="p">)</span> <span class="c1"># Set labels</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/statsmodels_24_0.png" src="../_images/statsmodels_24_0.png" />
</div>
</div>
<p>There is a positive relationship here - accounting for speeding and alcohol, accidents with higher premiums result in greater losses. There is some greater uncertainty about the <em>mean</em> of this relationship at the extreme ends of the <code class="docutils literal notranslate"><span class="pre">ins_premium</span></code> variable; but its quite focused. The prediction intervals on the other hand are much wider - the model implies that, for example, an accident with a $900 premium (and, don’t forget - average speeding and average alcohol use!) could lose anywhere between ~95 and ~170.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapter6"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="pingouin.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">1. </span>(Frequentist) Statistics in Python</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="generalised.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3. </span>Generalised Linear Models</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Alex Jones, Ph.D<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>